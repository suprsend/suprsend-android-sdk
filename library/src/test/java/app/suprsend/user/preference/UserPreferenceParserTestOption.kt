package app.suprsend.user.preference

import org.json.JSONObject
import org.junit.Assert
import org.junit.Test

class UserPreferenceParserTestOption {

    @Test
    fun preferenceTest() {
        Assert.assertEquals(PreferenceOptions.OPT_IN, SSInternalUserPreference.getPreference("opt_in"))
        Assert.assertEquals(PreferenceOptions.OPT_IN, SSInternalUserPreference.getPreference("OPT_IN"))
        Assert.assertEquals(PreferenceOptions.OPT_OUT, SSInternalUserPreference.getPreference("opt_out"))
        Assert.assertEquals(PreferenceOptions.OPT_OUT, SSInternalUserPreference.getPreference("OPT_OUT"))
    }

    @Test
    fun testFailure() {
        val userPreferences = UserPreferenceParser.parse(JSONObject())
        Assert.assertNotNull(userPreferences)
        Assert.assertTrue(userPreferences.sections.isEmpty())
        Assert.assertTrue(userPreferences.channelPreferences.isEmpty())
    }

    @Test
    fun testSuccess() {
        val userPreferences = UserPreferenceParser.parse(JSONObject(getJson()))
        Assert.assertNotNull(userPreferences)

        val section = userPreferences.sections.first()
        Assert.assertEquals("",section.name)

        Assert.assertEquals(11,section.subCategories.size)
        val subCategory = section.subCategories.first()
        Assert.assertEquals("Overall check for system",subCategory.name)
        Assert.assertEquals("overall-check-for-system",subCategory.category)
        Assert.assertEquals("These are the categories that your brand will be able to see and control from their preference page.",subCategory.description)
        Assert.assertEquals(PreferenceOptions.OPT_IN,subCategory.preferenceOptions)
        Assert.assertEquals(false,subCategory.isEditable)

        Assert.assertEquals(8,subCategory.channels.size)
        val channel = subCategory.channels.first()
        Assert.assertEquals("androidpush",channel.channel)
        Assert.assertEquals(PreferenceOptions.OPT_IN,channel.preferenceOptions)
        Assert.assertEquals(false,channel.isEditable)

        Assert.assertEquals(8,userPreferences.channelPreferences.size)
        val channelPreference =userPreferences.channelPreferences.first()
        Assert.assertEquals("androidpush",channelPreference.channel)
        Assert.assertEquals(false,channelPreference.isRestricted)

    }

    private fun getJson(): String {
        return """
            {"sections":[{"name":null,"subcategories":[{"name":"Overall check for system","category":"overall-check-for-system","description":"These are the categories that your brand will be able to see and control from their preference page.","original_preference":null,"preference":"opt_in","is_editable":false,"channels":[{"channel":"androidpush","preference":"opt_in","is_editable":false},{"channel":"email","preference":"opt_in","is_editable":false},{"channel":"inbox","preference":"opt_in","is_editable":false},{"channel":"iospush","preference":"opt_in","is_editable":false},{"channel":"slack","preference":"opt_in","is_editable":false},{"channel":"sms","preference":"opt_in","is_editable":false},{"channel":"webpush","preference":"opt_in","is_editable":false},{"channel":"whatsapp","preference":"opt_in","is_editable":false}]},{"name":"Do not publish","category":"do-not-publish","description":null,"original_preference":null,"preference":"opt_in","is_editable":true,"channels":[{"channel":"androidpush","preference":"opt_in","is_editable":true},{"channel":"email","preference":"opt_in","is_editable":true},{"channel":"inbox","preference":"opt_in","is_editable":true},{"channel":"iospush","preference":"opt_in","is_editable":true},{"channel":"slack","preference":"opt_in","is_editable":true},{"channel":"sms","preference":"opt_in","is_editable":true},{"channel":"webpush","preference":"opt_in","is_editable":true},{"channel":"whatsapp","preference":"opt_in","is_editable":true}]},{"name":"User opt in and out cases","category":"user-opt-in-and-out-cases","description":"These are the categories that your brand will be able to see and control from their preference page.","original_preference":null,"preference":"opt_out","is_editable":true,"channels":[]},{"name":"Overall check for promotional","category":"overall-check-for-promotional","description":"Play with on/ Off","original_preference":null,"preference":"opt_in","is_editable":true,"channels":[{"channel":"androidpush","preference":"opt_in","is_editable":true},{"channel":"email","preference":"opt_in","is_editable":true},{"channel":"inbox","preference":"opt_in","is_editable":true},{"channel":"iospush","preference":"opt_in","is_editable":true},{"channel":"slack","preference":"opt_in","is_editable":true},{"channel":"sms","preference":"opt_in","is_editable":true},{"channel":"webpush","preference":"opt_in","is_editable":true},{"channel":"whatsapp","preference":"opt_in","is_editable":true}]},{"name":"Refund_update_2","category":"refund_update_2","description":"verify on","original_preference":null,"preference":"opt_in","is_editable":false,"channels":[{"channel":"androidpush","preference":"opt_in","is_editable":false},{"channel":"email","preference":"opt_in","is_editable":true},{"channel":"inbox","preference":"opt_in","is_editable":false},{"channel":"iospush","preference":"opt_in","is_editable":true},{"channel":"slack","preference":"opt_in","is_editable":false},{"channel":"sms","preference":"opt_in","is_editable":true},{"channel":"webpush","preference":"opt_in","is_editable":true},{"channel":"whatsapp","preference":"opt_in","is_editable":true}]},{"name":"Brand null","category":"brand-null","description":null,"original_preference":null,"preference":"opt_in","is_editable":false,"channels":[{"channel":"androidpush","preference":"opt_in","is_editable":true},{"channel":"email","preference":"opt_in","is_editable":true},{"channel":"inbox","preference":"opt_in","is_editable":false},{"channel":"iospush","preference":"opt_in","is_editable":true},{"channel":"slack","preference":"opt_in","is_editable":true},{"channel":"sms","preference":"opt_in","is_editable":true},{"channel":"webpush","preference":"opt_in","is_editable":true},{"channel":"whatsapp","preference":"opt_in","is_editable":true}]},{"name":"Overall check for transactional","category":"overall-check-for-transactional","description":null,"original_preference":null,"preference":"opt_out","is_editable":true,"channels":[]},{"name":"OTP","category":"otp","description":"Check OTP","original_preference":null,"preference":"opt_in","is_editable":false,"channels":[{"channel":"androidpush","preference":"opt_in","is_editable":false},{"channel":"email","preference":"opt_in","is_editable":false},{"channel":"inbox","preference":"opt_in","is_editable":false},{"channel":"iospush","preference":"opt_in","is_editable":false},{"channel":"slack","preference":"opt_in","is_editable":false},{"channel":"sms","preference":"opt_in","is_editable":false},{"channel":"webpush","preference":"opt_in","is_editable":false},{"channel":"whatsapp","preference":"opt_in","is_editable":false}]},{"name":"Empty-null","category":"empty-null","description":"To verify null case","original_preference":null,"preference":"opt_in","is_editable":true,"channels":[{"channel":"androidpush","preference":"opt_in","is_editable":true},{"channel":"email","preference":"opt_in","is_editable":true},{"channel":"inbox","preference":"opt_in","is_editable":true},{"channel":"iospush","preference":"opt_in","is_editable":true},{"channel":"slack","preference":"opt_in","is_editable":true},{"channel":"sms","preference":"opt_in","is_editable":true},{"channel":"webpush","preference":"opt_in","is_editable":true},{"channel":"whatsapp","preference":"opt_in","is_editable":true}]},{"name":"Preference is ON","category":"preference-is-on","description":"Preference is ON","original_preference":null,"preference":"opt_in","is_editable":false,"channels":[{"channel":"androidpush","preference":"opt_in","is_editable":false},{"channel":"email","preference":"opt_in","is_editable":true},{"channel":"inbox","preference":"opt_in","is_editable":true},{"channel":"iospush","preference":"opt_in","is_editable":false},{"channel":"slack","preference":"opt_in","is_editable":true},{"channel":"sms","preference":"opt_in","is_editable":true},{"channel":"webpush","preference":"opt_in","is_editable":true},{"channel":"whatsapp","preference":"opt_in","is_editable":true}]},{"name":"Dynamic","category":"dynamic","description":null,"original_preference":null,"preference":"opt_out","is_editable":true,"channels":[]}]},{"name":"system section","description":"system section","subcategories":[{"name":"weekly-product-updates","category":"weekly-product-updates","description":"test1 recheck mbsdmhfbdhfbhfb","original_preference":null,"preference":"opt_in","is_editable":false,"channels":[{"channel":"androidpush","preference":"opt_in","is_editable":false},{"channel":"email","preference":"opt_in","is_editable":false},{"channel":"inbox","preference":"opt_in","is_editable":false},{"channel":"iospush","preference":"opt_in","is_editable":false},{"channel":"slack","preference":"opt_in","is_editable":false},{"channel":"sms","preference":"opt_in","is_editable":false},{"channel":"webpush","preference":"opt_in","is_editable":false},{"channel":"whatsapp","preference":"opt_in","is_editable":false}]}]},{"name":"Transactional karthick1","description":"Transactional karthick1","subcategories":[{"name":"Payment alert1","category":"payment-alert1","description":"Payment alert1","original_preference":null,"preference":"opt_in","is_editable":false,"channels":[{"channel":"androidpush","preference":"opt_in","is_editable":false},{"channel":"email","preference":"opt_in","is_editable":false},{"channel":"inbox","preference":"opt_in","is_editable":false},{"channel":"iospush","preference":"opt_in","is_editable":false},{"channel":"slack","preference":"opt_in","is_editable":true},{"channel":"sms","preference":"opt_in","is_editable":true},{"channel":"webpush","preference":"opt_in","is_editable":true},{"channel":"whatsapp","preference":"opt_in","is_editable":true}]},{"name":"test4","category":"test4","description":"test4 check","original_preference":null,"preference":"opt_out","is_editable":true,"channels":[]}]},{"name":"Safari final round 23op","description":"Safari final Safari final Safari final Safari final Safari final","subcategories":[{"name":"delete one 23","category":"delete-one-23","description":"delete one 234","original_preference":null,"preference":"opt_out","is_editable":true,"channels":[]}]},{"name":"Safari promotional section","description":"marketing and updates","subcategories":[{"name":"Promotional 1","category":"promotional-1","description":"Promotional","original_preference":null,"preference":"opt_in","is_editable":true,"channels":[{"channel":"androidpush","preference":"opt_in","is_editable":true},{"channel":"email","preference":"opt_in","is_editable":true},{"channel":"inbox","preference":"opt_in","is_editable":true},{"channel":"iospush","preference":"opt_in","is_editable":true},{"channel":"slack","preference":"opt_in","is_editable":true},{"channel":"sms","preference":"opt_in","is_editable":true},{"channel":"webpush","preference":"opt_in","is_editable":true},{"channel":"whatsapp","preference":"opt_in","is_editable":true}]},{"name":"Safari marketing","category":"safari-marketing","description":"Marketing","original_preference":null,"preference":"opt_out","is_editable":true,"channels":[]}]},{"name":"Old Categories","description":"Old Categories","subcategories":[{"name":"Seller Feedback","category":"seller-feedback","description":"Seller Feedback","original_preference":null,"preference":"opt_in","is_editable":true,"channels":[{"channel":"androidpush","preference":"opt_in","is_editable":true},{"channel":"email","preference":"opt_in","is_editable":true},{"channel":"inbox","preference":"opt_in","is_editable":true},{"channel":"iospush","preference":"opt_in","is_editable":true},{"channel":"slack","preference":"opt_in","is_editable":true},{"channel":"sms","preference":"opt_in","is_editable":true},{"channel":"webpush","preference":"opt_in","is_editable":true},{"channel":"whatsapp","preference":"opt_in","is_editable":true}]},{"name":"Newsletter","category":"newsletter","description":"Weekly newsletter","original_preference":null,"preference":"opt_in","is_editable":true,"channels":[{"channel":"androidpush","preference":"opt_in","is_editable":true},{"channel":"email","preference":"opt_in","is_editable":true},{"channel":"inbox","preference":"opt_in","is_editable":true},{"channel":"iospush","preference":"opt_in","is_editable":true},{"channel":"slack","preference":"opt_in","is_editable":true},{"channel":"sms","preference":"opt_in","is_editable":true},{"channel":"webpush","preference":"opt_in","is_editable":true},{"channel":"whatsapp","preference":"opt_in","is_editable":true}]}]}],"channel_preferences":[{"channel":"androidpush","is_restricted":false},{"channel":"email","is_restricted":false},{"channel":"inbox","is_restricted":false},{"channel":"iospush","is_restricted":false},{"channel":"slack","is_restricted":false},{"channel":"sms","is_restricted":false},{"channel":"webpush","is_restricted":false},{"channel":"whatsapp","is_restricted":false}]}
        """.trimIndent()
    }
}